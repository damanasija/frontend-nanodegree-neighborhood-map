var map,infoWindow,bounds,mapDiv=document.getElementById("map"),Location=function(o){var n=this;this.category=ko.observable(o.category),this.visible=ko.observable(!0),this.marker=new google.maps.Marker({position:o.location,title:o.title,animation:google.maps.Animation.DROP}),this.marker.addListener("click",function(){populateInfoWindow(this,o),toggleBounce(this)}),this.show=function(){google.maps.event.trigger(n.marker,"click")},this.filterMarkers=ko.computed(function(){!0===n.visible()?(n.marker.setMap(map),bounds.extend(n.marker.position),map.fitBounds(bounds)):n.marker.setMap(null)})};function populateInfoWindow(o,n){openInfoWindow(o,"<div><h3>"+n.title+"</h3><p>"+n.category+"</p></div>")}function openInfoWindow(o,n){infoWindow.marker!=o&&(infoWindow.marker=o,infoWindow.setContent(n),infoWindow.open(map,o),infoWindow.addListener("closeclick",function(){infoWindow.marker=null}))}function toggleBounce(o){null!=o.getAnimation()?o.setAnimation(null):(o.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){o.setAnimation(null)},1e3))}function AppViewModel(){var n=this;this.filter=ko.observable(""),this.markers=ko.observableArray([]),map=new google.maps.Map(mapDiv,{center:myCity.location,zoom:10}),infoWindow=new google.maps.InfoWindow,bounds=new google.maps.LatLngBounds,nearbyLocations.forEach(function(o){n.markers.push(new Location(o))}),this.locations=ko.computed(function(){var i=n.filter().toUpperCase();return i?ko.utils.arrayFilter(n.markers(),function(o){var n=o.marker.title.toUpperCase().includes(i);return o.visible(n),n}):(n.markers().forEach(function(o){o.visible(!0)}),n.markers())},n)}function loadError(o){$("#map").hide(),$("#error").append("<h2>"+o+"</h2>"),$("#error").show()}function init(){ko.applyBindings(new AppViewModel)}